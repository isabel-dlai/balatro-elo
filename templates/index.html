<!-- templates/index.html -->
{% extends "base.html" %}

{% block extra_css %}
<style>
    .card-comparison {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 40px;
        flex-wrap: wrap;
        margin: 40px 0;
    }
    
    .card {
        background-color: #111;
        border: 2px solid #333;
        border-radius: 10px;
        padding: 20px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
        max-width: 300px;
        min-height: 400px;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
    }
    
    .card:hover {
        border-color: #666;
        background-color: #222;
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(255, 255, 255, 0.1);
    }
    
    .card img {
        width: 100%;
        height: 250px;
        object-fit: cover;
        border-radius: 5px;
        margin-bottom: 15px;
    }
    
    .card h3 {
        font-size: 1.3rem;
        margin-bottom: 10px;
        color: #fff;
    }
    
    .card .elo {
        font-size: 1rem;
        color: #888;
        margin-bottom: 15px;
    }
    
    .card .select-btn {
        background-color: #007bff;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 1rem;
        transition: background-color 0.3s ease;
    }
    
    .card .select-btn:hover {
        background-color: #0056b3;
    }
    
    .vs {
        font-size: 2rem;
        color: #666;
        font-weight: bold;
    }
    
    .loading {
        display: none;
        text-align: center;
        font-size: 1.2rem;
        color: #666;
        margin: 20px 0;
    }
    
    @media (max-width: 768px) {
        .card-comparison {
            flex-direction: column;
            gap: 20px;
        }
        
        .vs {
            transform: rotate(90deg);
            margin: 0;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="card-comparison">
    <div class="card" onclick="selectCard('{{ card1.id }}', '{{ card2.id }}')">
        <div>
            <img src="{{ card1.image_url }}" alt="{{ card1.name }}" onerror="this.src='https://via.placeholder.com/250x250/333/666?text=No+Image'">
            <h3>{{ card1.name }}</h3>
        </div>
        <button class="select-btn">Select This Card</button>
    </div>
    
    <div class="vs">VS</div>
    
    <div class="card" onclick="selectCard('{{ card2.id }}', '{{ card1.id }}')">
        <div>
            <img src="{{ card2.image_url }}" alt="{{ card2.name }}" onerror="this.src='https://via.placeholder.com/250x250/333/666?text=No+Image'">
            <h3>{{ card2.name }}</h3>
        </div>
        <button class="select-btn">Select This Card</button>
    </div>
</div>

<div class="loading" id="loading">
    Recording your choice and loading new cards...
</div>

<div id="message"></div>
{% endblock %}

{% block extra_js %}
<script>
async function selectCard(winnerId, loserId) {
    // Show loading
    document.getElementById('loading').style.display = 'block';
    
    // Hide cards during processing
    document.querySelector('.card-comparison').style.opacity = '0.5';
    
    try {
        const formData = new FormData();
        formData.append('winner_id', winnerId);
        formData.append('loser_id', loserId);
        
        const response = await fetch('/compare', {
            method: 'POST',
            body: formData
        });
        
        const result = await response.json();
        
        if (result.success) {
            // Reload the page to get new cards
            window.location.reload();
        } else {
            showMessage('Error recording comparison', 'error');
        }
    } catch (error) {
        showMessage('Error: ' + error.message, 'error');
    } finally {
        document.getElementById('loading').style.display = 'none';
        document.querySelector('.card-comparison').style.opacity = '1';
    }
}

function showMessage(text, type) {
    const messageDiv = document.getElementById('message');
    messageDiv.className = type;
    messageDiv.textContent = text;
    messageDiv.style.display = 'block';
    
    setTimeout(() => {
        messageDiv.style.display = 'none';
    }, 3000);
}
</script>
{% endblock %}